<?php
require_once 'includes/db.php';
require_once 'admin/admin_functions.php';

$db = new Database();
$pdo = $db->getConnection();

// Тест отправки уведомления о новом тикете
echo "<h1>Тестирование уведомлений</h1>";

echo "<h2>Тест 1: Уведомление о новом тикете (администраторам)</h2>";
sendNotificationToSupport(1); // Используйте существующий ID тикета
echo "<p>Уведомление отправлено (если нет ошибок в логах)</p>";

echo "<h2>Тест 2: Уведомление о ответе на тикет (пользователю)</h2>";
sendNotificationToUser(1, "Это тестовый ответ на тикет от поддержки. Пожалуйста, проверьте решение вашей проблемы.");
echo "<p>Уведомление отправлено (если нет ошибок в логах)</p>";

echo "<h2>Тест 3: Уведомление об изменении статуса (пользователю)</h2>";
sendNotificationToUser(1, null, "closed");
echo "<p>Уведомление отправлено (если нет ошибок в логах)</p>";

echo "<h2>Проверьте:</h2>";
echo "<ul>
<li>Почту администраторов (должно прийти уведомление о новом тикете)</li>
<li>Почту пользователя (должны прийти уведомления о ответе и изменении статуса)</li>
<li>Телеграм-чат (если настроен TELEGRAM_CHAT_ID и TELEGRAM_BOT_TOKEN)</li>
<li>Лог ошибок в /logs/smtp_errors.log</li>
</ul>";